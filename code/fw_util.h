#ifndef _FW_UTIL_H_
#define _FW_UTIL_H_


typedef unsigned char  BYTE;
typedef unsigned short WORD;
typedef unsigned int   DWORD;


BYTE* GetStr(DWORD index);
DWORD GetEncryptIndex(BYTE* str);


BYTE* GetStr(DWORD index)
{
	BYTE* result = new BYTE[8];
	for(int j=0;j<8;j++)
	{ result[j] = 0; }
	
	BYTE len = 0;
	DWORD tmp = index;
	while(1)
	{
		tmp/=0x10;
		len++;
		if(tmp == 0) break;
	}

	for(int i=len-1; i>=0; i--)
	{
		BYTE ch = index % 0x10;
		
		if(ch>=0xA && ch<=0xF) 
			ch = (ch - 0xA) + 'A';
		else 
			ch += '0';
			
		index /= 0x10;
		result[i] = ch;
	}
	
	result[len] = 0x80;
		
	return result;
}

DWORD GetEncryptIndex(BYTE* str)
{
	DWORD _Param1 = str[0] + str[1]*(1<<0x8) + str[2]*(1<<0x10) + str[3]*(1<<0x18);
	DWORD _Param2 = str[4] + str[5]*(1<<0x8) + str[6]*(1<<0x10) + str[7]*(1<<0x18);

	DWORD _BitNum = 0;
	for(int i=0; i<8;i++)
	{ 
		if(str[i] == 0x80) 
		{	
			_BitNum = i*8;
			break;
		}
	}

	DWORD _Result = 0x67452301;
	DWORD _Tmp;
	DWORD _EBP;//avoid "Access Violation"

	__asm{
		MOV EAX,0
		MOV ECX,0
		MOV EDX,0
		MOV EBX,0x10325476
		MOV _EBP,0x98BADCFE
		MOV ESI,0xEFCDAB89
		MOV EDI,0x67452301
		MOV EAX,ESI
		MOV EDX,ESI
		AND EDX,_EBP
		NOT EAX
		AND EAX,EBX
		OR EAX,EDX
		ADD EAX,_Param1
		ADD EAX,0xD76AA478
		ADD EDI,EAX
		MOV EAX,EDI
		SHL EAX,0x7
		MOV ECX,EDI
		SHR ECX,0x19
		OR ECX,EAX
		ADD ECX,ESI
		MOV EDX,ECX
		MOV EAX,ECX
		AND EAX,ESI
		NOT EDX
		AND EDX,_EBP
		OR EDX,EAX
		MOV EAX,0
		ADD EDX,_Param2
		ADD EDX,0xE8C7B756
		ADD EBX,EDX
		MOV EDX,EBX
		SHL EDX,0x0C
		MOV EDI,EBX
		SHR EDI,0x14
		OR EDI,EDX
		ADD EDI,ECX
		MOV EAX,EDI
		MOV EBX,EDI
		AND EBX,ECX
		NOT EAX
		AND EAX,ESI
		OR EAX,EBX
		ADD EAX,0x242070DB
		ADD _EBP,EAX
		MOV EAX,_EBP
		SHL EAX,0x11
		MOV EDX,_EBP
		SHR EDX,0x0F
		OR EDX,EAX
		ADD EDX,EDI
		MOV EAX,0
		MOV EBX,EDX
		MOV EAX,EDX
		AND EAX,EDI
		NOT EBX
		AND EBX,ECX
		OR EBX,EAX
		MOV EAX,0
		ADD EBX,0xC1BDCEEE
		ADD ESI,EBX
		MOV EBX,ESI
		SHL EBX,0x16
		MOV _EBP,ESI
		SHR _EBP,0x0A
		OR _EBP,EBX
		ADD _EBP,EDX
		MOV ESI,_EBP
		MOV EAX,_EBP
		AND EAX,EDX
		NOT ESI
		AND ESI,EDI
		OR ESI,EAX
		MOV EAX,0
		ADD ESI,0xF57C0FAF
		ADD ECX,ESI
		MOV EBX,ECX
		SHL ECX,0x7
		SHR EBX,0x19
		OR EBX,ECX
		ADD EBX,_EBP
		MOV EAX,EBX
		MOV ESI,EBX
		AND ESI,_EBP
		NOT EAX
		AND EAX,EDX
		OR EAX,ESI
		ADD EAX,0x4787C62A
		ADD EDI,EAX
		MOV EAX,0
		MOV ECX,EDI
		SHL EDI,0x0C
		SHR ECX,0x14
		OR ECX,EDI
		ADD ECX,EBX
		MOV EDI,ECX
		MOV EAX,ECX
		AND EAX,EBX
		NOT EDI
		AND EDI,_EBP
		OR EDI,EAX
		MOV EAX,0
		ADD EDI,0xA8304613
		ADD EDX,EDI
		MOV ESI,EDX
		SHL EDX,0x11
		SHR ESI,0x0F
		OR ESI,EDX
		ADD ESI,ECX
		MOV EAX,ESI
		MOV EDI,ESI
		AND EDI,ECX
		NOT EAX
		AND EAX,EBX
		OR EAX,EDI
		ADD EAX,0xFD469501
		ADD _EBP,EAX
		MOV EAX,0
		MOV EDX,_EBP
		SHL _EBP,0x16
		SHR EDX,0x0A
		OR EDX,_EBP
		ADD EDX,ESI
		MOV _EBP,EDX
		MOV EAX,EDX
		AND EAX,ESI
		NOT _EBP
		AND _EBP,ECX
		OR _EBP,EAX
		MOV EAX,0
		ADD _EBP,0x698098D8
		ADD EBX,_EBP
		MOV EDI,EBX
		SHL EBX,0x7
		SHR EDI,0x19
		OR EDI,EBX
		ADD EDI,EDX
		MOV EAX,EDI
		MOV _EBP,EDI
		AND _EBP,EDX
		NOT EAX
		AND EAX,ESI
		OR EAX,_EBP
		ADD EAX,0x8B44F7AF
		ADD ECX,EAX
		MOV EAX,0
		MOV EBX,ECX
		SHL ECX,0x0C
		SHR EBX,0x14
		OR EBX,ECX
		ADD EBX,EDI
		MOV ECX,EBX
		MOV EAX,EBX
		AND EAX,EDI
		NOT ECX
		AND ECX,EDX
		OR ECX,EAX
		MOV EAX,0
		ADD ECX,0xFFFF5BB1
		ADD ESI,ECX
		MOV _EBP,ESI
		SHL ESI,0x11
		SHR _EBP,0x0F
		OR _EBP,ESI
		ADD _EBP,EBX
		MOV EAX,_EBP
		MOV ECX,_EBP
		AND ECX,EBX
		NOT EAX
		AND EAX,EDI
		OR EAX,ECX
		ADD EAX,0x895CD7BE
		ADD EDX,EAX
		MOV EAX,0
		MOV ESI,EDX
		SHL EDX,0x16
		SHR ESI,0x0A
		OR ESI,EDX
		ADD ESI,_EBP
		MOV EDX,ESI
		MOV EAX,ESI
		AND EAX,_EBP
		NOT EDX
		AND EDX,EBX
		OR EDX,EAX
		MOV EAX,0
		ADD EDX,0x6B901122
		ADD EDI,EDX
		MOV ECX,EDI
		SHL EDI,0x7
		SHR ECX,0x19
		OR ECX,EDI
		ADD ECX,ESI
		MOV EAX,ECX
		MOV EDX,ECX
		AND EDX,ESI
		NOT EAX
		AND EAX,_EBP
		OR EAX,EDX
		ADD EAX,0xFD987193
		ADD EBX,EAX
		MOV EDI,EBX
		SHL EBX,0x0C
		SHR EDI,0x14
		OR EDI,EBX
		ADD EDI,ECX
		MOV _Tmp,EDI
		NOT _Tmp
		MOV EBX,_Tmp
		AND EBX,ESI
		MOV EAX,EDI
		AND EAX,ECX
		OR EBX,EAX
		ADD EBX,_BitNum
		MOV EAX,0
		ADD EBX,0xA679438E
		ADD _EBP,EBX
		MOV EDX,_EBP
		SHL _EBP,0x11
		SHR EDX,0x0F
		OR EDX,_EBP
		ADD EDX,EDI
		MOV EBX,EDX
		NOT EBX
		MOV _EBP,EBX
		AND _EBP,ECX
		MOV EAX,EDX
		AND EAX,EDI
		OR _EBP,EAX
		ADD _EBP,0x49B40821
		ADD ESI,_EBP
		MOV _EBP,ESI
		SHL ESI,0x16
		SHR _EBP,0x0A
		OR _EBP,ESI
		ADD _EBP,EDX
		MOV EAX,EDX
		AND EAX,_Tmp
		MOV ESI,_EBP
		AND ESI,EDI
		OR EAX,ESI
		ADD EAX,_Param2
		ADD EAX,0xF61E2562
		ADD ECX,EAX
		MOV EAX,ECX
		SHL ECX,0x5
		SHR EAX,0x1B
		OR EAX,ECX
		ADD EAX,_EBP
		MOV ECX,_EBP
		AND ECX,EBX
		MOV ESI,EAX
		AND ESI,EDX
		OR ECX,ESI
		ADD ECX,0xC040B340
		ADD EDI,ECX
		MOV EBX,EDI
		SHL EDI,0x9
		SHR EBX,0x17
		OR EBX,EDI
		ADD EBX,EAX
		MOV EDI,_EBP
		MOV ESI,EBX
		AND ESI,_EBP
		NOT EDI
		AND EDI,EAX
		OR EDI,ESI
		ADD EDI,0x265E5A51
		ADD EDX,EDI
		MOV ECX,EDX
		SHL EDX,0x0E
		SHR ECX,0x12
		OR ECX,EDX
		ADD ECX,EBX
		MOV EDX,EAX
		MOV EDI,ECX
		AND EDI,EAX
		NOT EDX
		AND EDX,EBX
		OR EDX,EDI
		ADD EDX,_Param1
		ADD EDX,0xE9B6C7AA
		ADD _EBP,EDX
		MOV ESI,_EBP
		SHL _EBP,0x14
		SHR ESI,0x0C
		OR ESI,_EBP
		ADD ESI,ECX
		MOV EDI,EBX
		MOV EDX,ESI
		AND EDX,EBX
		NOT EDI
		AND EDI,ECX
		OR EDI,EDX
		ADD EDI,0xD62F105D
		ADD EAX,EDI
		MOV _EBP,EAX
		SHL EAX,0x5
		SHR _EBP,0x1B
		OR _EBP,EAX
		ADD _EBP,ESI
		MOV EAX,ECX
		MOV EDI,_EBP
		AND EDI,ECX
		NOT EAX
		AND EAX,ESI
		OR EAX,EDI
		ADD EAX,0x2441453
		ADD EBX,EAX
		MOV EDX,EBX
		SHL EBX,0x9
		SHR EDX,0x17
		OR EDX,EBX
		ADD EDX,_EBP
		MOV EBX,ESI
		MOV EAX,EDX
		AND EAX,ESI
		NOT EBX
		AND EBX,_EBP
		OR EBX,EAX
		ADD EBX,0xD8A1E681
		ADD ECX,EBX
		MOV EDI,ECX
		SHL ECX,0x0E
		SHR EDI,0x12
		OR EDI,ECX
		ADD EDI,EDX
		MOV EAX,_EBP
		MOV EBX,EDI
		AND EBX,_EBP
		NOT EAX
		AND EAX,EDX
		OR EAX,EBX
		ADD EAX,0xE7D3FBC8
		ADD ESI,EAX
		MOV ECX,ESI
		SHL ESI,0x14
		SHR ECX,0x0C
		OR ECX,ESI
		ADD ECX,EDI
		MOV ESI,EDX
		MOV EAX,ECX
		AND EAX,EDX
		NOT ESI
		AND ESI,EDI
		OR ESI,EAX
		ADD ESI,0x21E1CDE6
		ADD _EBP,ESI
		MOV EBX,_EBP
		SHL _EBP,0x5
		SHR EBX,0x1B
		OR EBX,_EBP
		ADD EBX,ECX
		MOV _EBP,EDI
		MOV ESI,EBX
		AND ESI,EDI
		NOT _EBP
		AND _EBP,ECX
		OR _EBP,ESI

		PUSH EAX
		MOV EAX,_EBP
		ADD EAX,_BitNum
		MOV _EBP,EAX
		POP EAX

		ADD _EBP,0xC33707D6
		ADD EDX,_EBP
		MOV EAX,EDX
		SHL EDX,0x9
		SHR EAX,0x17
		OR EAX,EDX
		ADD EAX,EBX
		MOV ESI,ECX
		MOV _EBP,EAX
		AND _EBP,ECX
		NOT ESI
		AND ESI,EBX
		OR ESI,_EBP
		ADD ESI,0xF4D50D87
		ADD EDI,ESI
		MOV EDX,EDI
		SHL EDI,0x0E
		SHR EDX,0x12
		OR EDX,EDI
		ADD EDX,EAX
		MOV EDI,EBX
		MOV ESI,EDX
		AND ESI,EBX
		NOT EDI
		AND EDI,EAX
		OR EDI,ESI
		ADD EDI,0x455A14ED
		ADD ECX,EDI
		MOV _EBP,ECX
		SHL ECX,0x14
		SHR _EBP,0x0C
		OR _EBP,ECX
		ADD _EBP,EDX
		MOV ECX,EAX
		MOV EDI,_EBP
		AND EDI,EAX
		NOT ECX
		AND ECX,EDX
		OR ECX,EDI
		ADD ECX,0xA9E3E905
		ADD EBX,ECX
		MOV ESI,EBX
		SHL EBX,0x5
		SHR ESI,0x1B
		OR ESI,EBX
		ADD ESI,_EBP
		MOV EDI,EDX
		MOV ECX,ESI
		AND ECX,EDX
		NOT EDI
		AND EDI,_EBP
		OR EDI,ECX
		ADD EDI,0xFCEFA3F8
		ADD EAX,EDI
		MOV EBX,EAX
		SHL EAX,0x9
		SHR EBX,0x17
		OR EBX,EAX
		ADD EBX,ESI
		MOV EAX,_EBP
		MOV EDI,EBX
		AND EDI,_EBP
		NOT EAX
		AND EAX,ESI
		OR EAX,EDI
		ADD EAX,0x676F02D9
		ADD EDX,EAX
		MOV ECX,EDX
		SHL EDX,0x0E
		SHR ECX,0x12
		OR ECX,EDX
		ADD ECX,EBX
		MOV EDX,ESI
		MOV EAX,ECX
		AND EAX,ESI
		NOT EDX
		AND EDX,EBX
		OR EDX,EAX
		ADD EDX,0x8D2A4C8A
		ADD _EBP,EDX
		MOV EDI,_EBP
		SHL _EBP,0x14
		SHR EDI,0x0C
		OR EDI,_EBP
		ADD EDI,ECX
		MOV EDX,EDI
		XOR EDX,ECX
		XOR EDX,EBX
		ADD EDX,0xFFFA3942
		ADD ESI,EDX
		MOV _EBP,ESI
		SHL ESI,0x4
		SHR _EBP,0x1C
		OR _EBP,ESI
		ADD _EBP,EDI
		MOV EAX,_EBP
		XOR EAX,EDI
		XOR EAX,ECX
		ADD EAX,0x8771F681
		ADD EBX,EAX
		MOV EDX,EBX
		SHL EBX,0x0B
		SHR EDX,0x15
		OR EDX,EBX
		ADD EDX,_EBP
		MOV ESI,EDX
		XOR ESI,_EBP
		XOR ESI,EDI
		ADD ESI,0x6D9D6122
		ADD ECX,ESI
		MOV EAX,ECX
		SHL ECX,0x10
		SHR EAX,0x10
		OR EAX,ECX
		ADD EAX,EDX
		MOV EBX,EAX
		XOR EBX,EDX
		XOR EBX,_EBP
		ADD EBX,_BitNum
		ADD EBX,0xFDE5380C
		ADD EDI,EBX
		MOV ECX,EDI
		SHL EDI,0x17
		SHR ECX,0x9
		OR ECX,EDI
		ADD ECX,EAX
		MOV ESI,ECX
		XOR ESI,EAX
		XOR ESI,EDX
		ADD ESI,_Param2
		ADD ESI,0xA4BEEA44
		ADD _EBP,ESI
		MOV EBX,_EBP
		SHL _EBP,0x4
		SHR EBX,0x1C
		OR EBX,_EBP
		ADD EBX,ECX
		MOV EDI,EBX
		XOR EDI,ECX
		XOR EDI,EAX
		ADD EDI,0x4BDECFA9
		ADD EDX,EDI
		MOV ESI,EDX
		SHL EDX,0x0B
		SHR ESI,0x15
		OR ESI,EDX
		ADD ESI,EBX
		MOV _EBP,ESI
		XOR _EBP,EBX
		XOR _EBP,ECX
		ADD _EBP,0xF6BB4B60
		ADD EAX,_EBP
		MOV EDX,EAX
		SHL EAX,0x10
		SHR EDX,0x10
		OR EDX,EAX
		ADD EDX,ESI
		MOV EDI,EDX
		XOR EDI,ESI
		XOR EDI,EBX
		ADD EDI,0xBEBFBC70
		ADD ECX,EDI
		MOV _EBP,ECX
		SHL ECX,0x17
		SHR _EBP,0x9
		OR _EBP,ECX
		ADD _EBP,EDX
		MOV EAX,_EBP
		XOR EAX,EDX
		XOR EAX,ESI
		ADD EAX,0x289B7EC6
		ADD EBX,EAX
		MOV EDI,EBX
		SHL EBX,0x4
		SHR EDI,0x1C
		OR EDI,EBX
		ADD EDI,_EBP
		MOV ECX,EDI
		XOR ECX,_EBP
		XOR ECX,EDX
		ADD ECX,_Param1
		ADD ECX,0xEAA127FA
		ADD ESI,ECX
		MOV EBX,ESI
		SHL ESI,0x0B
		SHR EBX,0x15
		OR EBX,ESI
		ADD EBX,EDI
		MOV EAX,EBX
		XOR EAX,EDI
		XOR EAX,_EBP
		ADD EAX,0xD4EF3085
		ADD EDX,EAX
		MOV ECX,EDX
		SHL EDX,0x10
		SHR ECX,0x10
		OR ECX,EDX
		ADD ECX,EBX
		MOV ESI,ECX
		XOR ESI,EBX
		XOR ESI,EDI
		ADD ESI,0x4881D05
		ADD _EBP,ESI
		MOV EAX,_EBP
		SHL _EBP,0x17
		SHR EAX,0x9
		OR EAX,_EBP
		ADD EAX,ECX
		MOV EDX,EAX
		XOR EDX,ECX
		XOR EDX,EBX
		ADD EDX,0xD9D4D039
		ADD EDI,EDX
		MOV _EBP,EDI
		SHL EDI,0x4
		SHR _EBP,0x1C
		OR _EBP,EDI
		ADD _EBP,EAX
		MOV ESI,_EBP
		XOR ESI,EAX
		XOR ESI,ECX
		ADD ESI,0xE6DB99E5
		ADD EBX,ESI
		MOV EDX,EBX
		SHL EBX,0x0B
		SHR EDX,0x15
		OR EDX,EBX
		ADD EDX,_EBP
		MOV EDI,EDX
		XOR EDI,_EBP
		XOR EDI,EAX
		ADD EDI,0x1FA27CF8
		ADD ECX,EDI
		MOV ESI,ECX
		SHL ECX,0x10
		SHR ESI,0x10
		OR ESI,ECX
		ADD ESI,EDX
		MOV EBX,ESI
		XOR EBX,EDX
		XOR EBX,_EBP
		ADD EBX,0xC4AC5665
		ADD EAX,EBX
		MOV ECX,EAX
		SHL EAX,0x17
		SHR ECX,0x9
		OR ECX,EAX
		ADD ECX,ESI
		MOV EDI,EDX
		MOV EAX,ESI
		NOT EDI
		OR EDI,ECX
		XOR EDI,ESI
		ADD EDI,_Param1
		ADD EDI,0xF4292244
		ADD _EBP,EDI
		MOV EBX,_EBP
		SHL _EBP,0x6
		SHR EBX,0x1A
		OR EBX,_EBP
		ADD EBX,ECX
		MOV _EBP,ECX
		NOT EAX
		OR EAX,EBX
		XOR EAX,ECX
		ADD EAX,0x432AFF97
		ADD EDX,EAX
		MOV EDI,EDX
		SHL EDX,0x0A
		SHR EDI,0x16
		OR EDI,EDX
		ADD EDI,EBX
		MOV EAX,EBX
		NOT _EBP
		OR _EBP,EDI
		XOR _EBP,EBX

		PUSH EAX
		MOV EAX,_EBP
		ADD EAX,_BitNum
		MOV _EBP,EAX
		POP EAX

		ADD _EBP,0xAB9423A7
		ADD ESI,_EBP
		MOV EDX,ESI
		SHL ESI,0x0F
		SHR EDX,0x11
		OR EDX,ESI
		ADD EDX,EDI
		MOV ESI,EDI
		NOT EAX
		OR EAX,EDX
		XOR EAX,EDI
		ADD EAX,0xFC93A039
		ADD ECX,EAX
		MOV _EBP,ECX
		SHL ECX,0x15
		SHR _EBP,0x0B
		OR _EBP,ECX
		ADD _EBP,EDX
		MOV ECX,EDX
		NOT ESI
		OR ESI,_EBP
		XOR ESI,EDX
		ADD ESI,0x655B59C3
		ADD EBX,ESI
		MOV EAX,EBX
		SHL EBX,0x6
		SHR EAX,0x1A
		OR EAX,EBX
		ADD EAX,_EBP
		MOV ESI,_EBP
		NOT ECX
		OR ECX,EAX
		XOR ECX,_EBP
		ADD ECX,0x8F0CCC92
		ADD EDI,ECX
		MOV EBX,EDI
		SHL EDI,0x0A
		SHR EBX,0x16
		OR EBX,EDI
		ADD EBX,EAX
		MOV EDI,EAX
		NOT ESI
		OR ESI,EBX
		XOR ESI,EAX
		ADD ESI,0xFFEFF47D
		ADD EDX,ESI
		MOV ECX,EDX
		SHL EDX,0x0F
		SHR ECX,0x11
		OR ECX,EDX
		ADD ECX,EBX
		MOV EDX,EBX
		NOT EDI
		OR EDI,ECX
		XOR EDI,EBX
		ADD EDI,_Param2
		ADD EDI,0x85845DD1
		ADD _EBP,EDI
		MOV ESI,_EBP
		SHL _EBP,0x15
		SHR ESI,0x0B
		OR ESI,_EBP
		ADD ESI,ECX
		MOV EDI,ECX
		NOT EDX
		OR EDX,ESI
		XOR EDX,ECX
		ADD EDX,0x6FA87E4F
		ADD EAX,EDX
		MOV _EBP,EAX
		SHL EAX,0x6
		SHR _EBP,0x1A
		OR _EBP,EAX
		ADD _EBP,ESI
		MOV EAX,ESI
		NOT EDI
		OR EDI,_EBP
		XOR EDI,ESI
		ADD EDI,0xFE2CE6E0
		ADD EBX,EDI
		MOV EDX,EBX
		SHL EBX,0x0A
		SHR EDX,0x16
		OR EDX,EBX
		ADD EDX,_EBP
		MOV EBX,_EBP
		NOT EAX
		OR EAX,EDX
		XOR EAX,_EBP
		ADD EAX,0xA3014314
		ADD ECX,EAX
		MOV EDI,ECX
		SHL ECX,0x0F
		SHR EDI,0x11
		OR EDI,ECX
		ADD EDI,EDX
		NOT EBX
		OR EBX,EDI
		XOR EBX,EDX
		ADD EBX,0x4E0811A1
		ADD ESI,EBX
		MOV EAX,ESI
		SHL ESI,0x15
		SHR EAX,0x0B
		OR EAX,ESI
		ADD EAX,EDI
		MOV EBX,EDX
		MOV ESI,EDI
		NOT EBX
		OR EBX,EAX
		XOR EBX,EDI
		ADD EBX,0xF7537E82
		ADD _EBP,EBX
		MOV ECX,_EBP
		SHL _EBP,0x6
		SHR ECX,0x1A
		OR ECX,_EBP
		ADD ECX,EAX
		ADD _Result,ECX
	}

	return _Result;
}

#endif